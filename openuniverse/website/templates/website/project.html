<!-- Importing base.html as template -->
{% extends 'website/base.html' %}
{% load staticfiles %}
<!-- Page Title -->
{% block title %} {{project.name}} {% endblock %}
<!-- Page Stylesheets -->
{% block css  %}
	<link href="{% static 'css/index.css' %}" rel="stylesheet" type="text/css">
{% endblock  %}

{% block body %}
	<div class="container">
		<h2><b>{{project.name | capfirst}}</b></h2>
		<h3>{{project.url}}</h3>
		<h3>{{project.main_language}}</h3>
		<h3>{{project.owner_type}}</h3>
		<h3>Has README.md? {{project.features.has_readme}}</h3>
		<h3>Total of pull-requests merged: {{project.statistics.pulls_merged_total}}</h3>
		<div id="{{project.project_id}}_newcomers_ts"></div>
		<div id="{{project.project_id}}_forks_ts"></div>
		<div id="{{project.project_id}}_pulls_merged_ts"></div>
	</div>
{% endblock %}

<!-- Google Charts script -->
{% block javascript %}
	<script>
	google.charts.load('current', {'packages':['line']});
	google.charts.setOnLoadCallback(drawNewcomersTS);
	google.charts.setOnLoadCallback(drawForksTS);
	google.charts.setOnLoadCallback(drawPullsMergedTS);
		
	function drawNewcomersTS(){
		var data = new google.visualization.DataTable();
		data.addColumn('datetime', 'Date');
		data.addColumn('number', '# Newcomers');

		var rows = []
		{% for key, value in project.time_series.newcomers_ts.items %}
		rows.push([new Date("{{ key }}"), {{ value }}]);
		{% endfor %}
		rows.sort(function(a,b){return a[0].getTime() - b[0].getTime()})
		data.addRows(rows);
		
		var options = { title:'Newcomers (Daily)', curveType: 'function'};
		var {{project.project_id}}_newcomers_ts = new google.charts.Line(document.getElementById('{{project.project_id}}_newcomers_ts'));		
		{{project.project_id}}_newcomers_ts.draw(data, options);
	}

	function drawForksTS(){
		var data = new google.visualization.DataTable();
		data.addColumn('datetime', 'Date');
		data.addColumn('number', '# Forks');

		var rows = []
		{% for key, value in project.time_series.forks_ts.items %}
		rows.push([new Date("{{ key }}"), {{ value }}]);
		{% endfor %}
		rows.sort(function(a,b){return a[0].getTime() - b[0].getTime()})
		data.addRows(rows);
		
		var options = { title:'Forks (Daily)', curveType: 'function'};
		var {{project.project_id}}_forks_ts = new google.charts.Line(document.getElementById('{{project.project_id}}_forks_ts'));		
		{{project.project_id}}_forks_ts.draw(data, options);
	}

	function drawPullsMergedTS(){
		var data = new google.visualization.DataTable();
		data.addColumn('datetime', 'Date');
		data.addColumn('number', '# Pulls Merged');

		var rows = []
		{% for key, value in project.time_series.pulls_merged_ts.items %}
		rows.push([new Date("{{ key }}"), {{ value }}]);
		{% endfor %}
		rows.sort(function(a,b){return a[0].getTime() - b[0].getTime()})
		data.addRows(rows);
		
		var options = { title:'Pulls Merged (Daily)', curveType: 'function'};
		var {{project.project_id}}_pulls_merged_ts = new google.charts.Line(document.getElementById('{{project.project_id}}_pulls_merged_ts'));		
		{{project.project_id}}_pulls_merged_ts.draw(data, options);
	}

	</script>
{% endblock %}
