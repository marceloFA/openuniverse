<!-- Importing base.html as template -->
{% extends 'website/base.html' %}
{% load staticfiles %}
<!-- Page Title -->
{% block title %} {{project.name}} {% endblock %}
<!-- Page Stylesheets -->
{% block css  %}
	<link href="{% static 'css/index.css' %}" rel="stylesheet" type="text/css">
{% endblock  %}

{% block body %}
	<div class="container">
		<div class="row">
			<div class="col-lg-6">
			<h1 style="display: inline; text-decoration: none;">{{project.name | capfirst}}  </h1><br>| Mostly written in {{project.main_language}}<br>
			{% include 'website/_badges.html' %}<br>
			<a href="{{project.github_url}}" target="_blank">Github offical repository</a>  <span class="fab fa-github"></span>
			<h5>Data for this project was collected in {{ project.updated_at|time:"D d M Y" }} (formatted datetime stamp to be inserted here)</h5>
		<!-- Tabela pra monstrar umas estatÃ­sticas legais: -->
			</div>
			<br>
			<div class="col-lg-6">
			<h4>
				<span><img src="{% static 'resources/icons/png/021-diagnosis.png' %}" height="35px" width="35px" class="img-fluid"></span>
				Statistics on this project
			</h4>
			<table class="table">
			  <tbody>
			    <tr>
			      <th>Newcomers Total</th>
			      <td>{{project.statistics.newcomers_total}}</td>
			    </tr>
			    <tr>
			      <th scope="row">Total Forks</th>
			      <td>{{project.statistics.forks_total}}</td>
			    </tr>
			    <tr>
			      <th scope="row">Total pull requests merged</th>
			      <td>{{project.statistics.pulls_merged_total}}</td>
			    </tr>
			    <tr>
			      <th scope="row">Contributors total</th>
			      <td>{{project.statistics.contributors_total}}</td>
			    </tr>    
			  </tbody>
			</table>
		</div>
		</div>
		
		<!-- Charts below: -->
		<div id="{{project.project_id}}_newcomers_ts"></div>
		<div id="{{project.project_id}}_forks_ts"></div>
		<div id="{{project.project_id}}_pulls_merged_ts"></div>

	</div>
{% endblock %}

<!-- Google Charts script -->
{% block javascript %}
	<script>
	google.charts.load('current', {'packages':['line']});
	google.charts.setOnLoadCallback(drawNewcomersTS);
	google.charts.setOnLoadCallback(drawForksTS);
	google.charts.setOnLoadCallback(drawPullsMergedTS);
		
	function drawNewcomersTS(){
		var data = new google.visualization.DataTable();
		data.addColumn('datetime', 'Date');
		data.addColumn('number', '# Newcomers');

		var rows = []
		{% for key, value in project.time_series.newcomers_ts.items %}
		rows.push([new Date("{{ key }}"), {{ value }}]);
		{% endfor %}
		rows.sort(function(a,b){return a[0].getTime() - b[0].getTime()})
		data.addRows(rows);
		
		var options = { title:'Newcomers (Daily)', curveType: 'function',
						aggregationTarget: 'auto'};
		var {{project.project_id}}_newcomers_ts = new google.charts.Line(document.getElementById('{{project.project_id}}_newcomers_ts'));		
		{{project.project_id}}_newcomers_ts.draw(data, options);
	}

	function drawForksTS(){
		var data = new google.visualization.DataTable();
		data.addColumn('datetime', 'Date');
		data.addColumn('number', '# Forks');

		var rows = []
		{% for key, value in project.time_series.forks_ts.items %}
		rows.push([new Date("{{ key }}"), {{ value }}]);
		{% endfor %}
		rows.sort(function(a,b){return a[0].getTime() - b[0].getTime()})
		data.addRows(rows);
		
		var options = { title:'Forks (Daily)', curveType: 'function'};
		var {{project.project_id}}_forks_ts = new google.charts.Line(document.getElementById('{{project.project_id}}_forks_ts'));		
		{{project.project_id}}_forks_ts.draw(data, options);
	}

	function drawPullsMergedTS(){
		var data = new google.visualization.DataTable();
		data.addColumn('datetime', 'Date');
		data.addColumn('number', '# Pulls Merged');

		var rows = []
		{% for key, value in project.time_series.pulls_merged_ts.items %}
		rows.push([new Date("{{ key }}"), {{ value }}]);
		{% endfor %}
		rows.sort(function(a,b){return a[0].getTime() - b[0].getTime()})
		data.addRows(rows);
		
		var options = { title:'Pulls Merged (Daily)', curveType: 'function'};
		var {{project.project_id}}_pulls_merged_ts = new google.charts.Line(document.getElementById('{{project.project_id}}_pulls_merged_ts'));		
		{{project.project_id}}_pulls_merged_ts.draw(data, options);
	}

	</script>
{% endblock %}
